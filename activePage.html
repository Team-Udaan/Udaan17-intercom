<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width,user">
    <link rel="stylesheet" href="css/style.css">
    <script src="node_modules/simplewebrtc/latest-v2.js"></script>
    <script src="node_modules/page/page.js"></script>
</head>
<body>
<video height="300" id="localVideo"></video>
<div id="remotes"></div>
<button id="end-call" onclick="endCall()">End call</button>
<button id="mute-video" onclick="toggleAudio()">Toggle Audio</button>
<button id="mute-audio" onclick="toggleVideo()">Toggle Video</button>
<script>

    var video = true;
    var audio = true;

    var webrtc = new SimpleWebRTC({
        localVideoEl: 'localVideo',
        remoteVideosEl: 'remotesVideos',
        url: 'https://' + location.hostname + ":8888",
        autoRequestMedia: true,
        media: {
            video: {
                mandatory: {
                    "minWidth": 320,
                    "maxWidth": 1280,
                    "minHeight": 480,
                    "maxHeight": 720
                }
            },
            audio: true
        }
    });

    webrtc.on('readyToCall', function () {
        var room = location.search.split('?')[1];
        webrtc.joinRoom(room);
    });

    webrtc.connection.on('remove', function () {
//        webrtc.disconnect();
//        page('/');
    });

    webrtc.on('videoAdded', function (video, peer) {
        console.log('video added', peer);
        var remotes = document.getElementById('remotes');
        if (remotes) {
            var container = document.createElement('div');
            container.className = 'videoContainer';
            container.id = 'container_' + webrtc.getDomId(peer);
            container.appendChild(video);

            // suppress contextmenu
            video.oncontextmenu = function () {
                return false;
            };

            remotes.appendChild(container);
        }
    });

    function endCall() {
        webrtc.disconnect();
        page('/');
    }

    function toggleAudio() {
        if (audio) {
            webrtc.mute();
        }
        else {
            webrtc.unmute();
        }
        audio = !audio;
    }

    function toggleVideo() {
        if (video) {
            webrtc.pauseVideo();
        }
        else {
            webrtc.resumeVideo();
        }
        video = !video;
    }

</script>
</body>
</html>