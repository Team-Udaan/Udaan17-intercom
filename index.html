<!DOCTYPE html>
<html>
<head>
    <script src="node_modules/simplewebrtc/latest-v2.js"></script>
    <script src="jquery-3.1.1.min.js"></script>
    <script src="node_modules/page/page.js"></script>
    <script src="handlebars.runtime.min.js"></script>
    <script src="calling-buttons.min.js"></script>
</head>
<body>


<input type="text" id="username">
<button id="submit">Submit</button>
<button id="leave">Leave</button>
<button id="page">page</button>
<video height="300" id="localVideo"></video>
<div id="remotesVideos"></div>

<div id="peers"></div>

<script>



    var allPeers = {};
    var peerInfo = {};
    var webrtc = null;

    $('#page').click(function () {
        page('/active')
    });
    $('#submit').click(function () {


        var username = $('#username').val();
        peerInfo.username = username;
        webrtc = new SimpleWebRTC({

//            url: 'https://localhost:8888',
            autoRequestMedia: true,
            nick: username
        });

        webrtc.on('readyToCall', function () {
                webrtc.joinRoom('idle');
        });

        webrtc.on('videoAdded', function (videoEl,peer) {
            allPeers=webrtc.getPeers().map(function (peer) {
                return {nick:peer.nick,id:peer.id}
            });
            var peerListTemplate = Handlebars.templates['calling-buttons']({'allPeers':JSON.parse(JSON.stringify(allPeers))});
            $('#peers').html(peerListTemplate);
        });

        webrtc.connection.on('remove', function(obj) {
            allPeers=webrtc.getPeers().map(function (peer) {
                return {nick:peer.nick,id:peer.id}
            });
            var peerListTemplate = Handlebars.templates['calling-buttons']({'allPeers':JSON.parse(JSON.stringify(allPeers))});
            $('#peers').html(peerListTemplate);
        });

        $('#leave').click(function () {
            webrtc.sendToAll('left', peerInfo);
            webrtc.leaveRoom();
        });


    });

    $(window).on('unload', (function () {
        webrtc.leaveRoom();
    }));

    $('.call').click(function (event) {
        console.log("maunil");
        event.preventDefault();
    });
</script>
</body>
</html>